@page
@model frontend.Pages.AziendaAgricola.OfferteGestoriModel
@{
    ViewData["Page"] = "Offerte Gestori";
}

<link rel="stylesheet" href="~/css/table.css" asp-append-version="true" />

<div style="margin: 1em;">
    <h4>Offerte gestori</h4>
    <small>• Vengono visualizzate tutte le offerte d'acqua di tutti i gestori idrici. &Egrave; possibile acquistare una quantità di acqua entro i limiti consentiti. </small>
    <hr style="margin-top: 0.5em; margin-bottom: 1em;">
    
    @if (TempData.ContainsKey("Messaggio"))
    {
        <div class="alert alert-info" role="alert">
            @TempData["Messaggio"]
        </div>
    }

    @if (TempData.ContainsKey("MessaggioErrore"))
    {
        <div class="alert alert-danger" role="alert">
            @TempData["MessaggioErrore"]
        </div>
    }

    <table id="tabOfferte" class="table">
        <thead>
            <tr>
                <th>Id</th>
                <th>Partita IVA</th>
                <th>Data Annuncio</th>
                <th>Prezzo Litro</th>
                <th>Quantità d'Acqua Disponibile (litri)</th>
                <th>Azioni</th>
            </tr>
        </thead>
        <tbody>

            @foreach (var offerta in Model.Offerte)
            {
                <tr>
                    <td>@offerta.Id</td>
                    <td>@offerta.PartitaIva</td>
                    <td>@offerta.DataAnnuncio</td>
                    <td>@offerta.PrezzoLitro</td>
                    <td>@offerta.Quantita</td>
                    <td>
                        <button class="btn btn-primary" data-toggle="modal" data-target="#modalOrdine\@offerta.Id">Acquista</button>
                    </td>
                </tr>

                <!-- Modale per l'ordine di acquisto -->
                <div id="modalOrdine\@offerta.Id" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="modalOrdine\@offerta.Id" aria-hidden="true" data-backdrop="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="ModalLabelOrdine\@offerta.Id">Acquista acqua dall'offerta #@offerta.Id</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form method="post" asp-page-handler="OrdineAcquisto">
                                    <div class="form-group">
                                        <label for="colturaId">Seleziona la Coltura</label>
                                        <select class="form-control" id="colturaId" name="colturaId" required>
                                            @foreach (var coltura in Model.Colture)
                                            {
                                                <option value="@coltura.Id">Id @coltura.Id - @coltura.TipoColtura - @coltura.MetriQuadrati mq - @coltura.TipoIrrigazione</option>
                                            }
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="quantitaAcquisto">Quantità d'acqua da acquistare per la coltura selezionata</label>
                                        <input type="number" class="form-control" id="quantitaAcquisto" name="quantitaAcquisto" step="0.01" min="1" max="@offerta.Quantita" required>
                                    </div>
                                    <input type="hidden" id="offertaId" name="offertaId" value="@offerta.Id" readonly />
                                    <button type="submit" class="btn btn-primary">Conferma Acquisto</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

            }

        </tbody>
    </table>
</div>
